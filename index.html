<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript" src="./RandomStrings.js"></script>
	<style>
		body, div, p {
			margin:0;
			padding:0;
			border:0;
		}
		h1,h2,h3,h4,h5,h6 {
			margin-top:0.8em;
			margin-bottom:0.1em;
		}
		.container {
			padding: 0.3em;
			word-break: break-all;
			line-height: 1.5em;
		}
		#gen_rand_str table {
			border-collapse: collapse;
		}
		#gen_rand_str table td {
			border: 1px solid #eeeeee;
			padding: 0.3em;
		}
		#gen_rand_str input[type="number"]{
			font-size:1.1em;
		}
		.symbols {
			display: inline-block;
			border: 1px solid #cccccc;
			background-color: #eeeeee;
			border-radius: 0.3em;
		}
		.symbols input[type="checkbox"]{
			padding: 0;
			margin: 0 0 0 0.4em;
		}
		.symbols label{
			padding: 0;
			margin: 0 0.4em 0 0;
		}
		.symbols.checked{
			background-color:#88eeaa;
			font-weight: bold;
		}
		.gen_result{
			border: 1px solid #cccccc;
			background-color: #eeeeee;
			padding: 0.2em;
			margin: 0.3em 0;
			cursor: pointer;
		}
		.gen_result.copied{
			background-color:#88eeaa;
		}
	</style>
	<script>
		var onloaded = function(){
			var symbols = document.querySelectorAll(".symbols input[type='checkbox']");
			symbols.forEach(function(elem, key){
				elem.onclick = function(){
					checkedColorChange(elem);
				};
				checkedColorChange(elem);
			})
			console.dir(symbols);
			run();
		};
		var checkedColorChange = function(elem){
			var checkedsymbols = document.querySelectorAll(".symbols input[type='checkbox']:checked");
			document.querySelector("#strtype_symbol").checked = checkedsymbols.length ? true : false;
			if(elem.checked){
				elem.parentNode.classList.add('checked');
			} else {
				elem.parentNode.classList.remove('checked');
			}
		};
		var str_alias = {
			"a-z" : "abcdefghijklmnopqrstuvwxyz",
			"A-Z" : "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
			"0-9" : "1234567890"
		}
		var run = function(){
			var requiredptn = [];
			var selectedstrtypes = [];
			var selectedptntypes = [];
			var strtypes = document.querySelectorAll(".strtypes input[type='checkbox']:checked");
			strtypes.forEach(function(elem, key){
				selectedstrtypes.push(str_alias[elem.value]);
				selectedptntypes.push(elem.value);
				requiredptn.push("(?=.*[" + elem.value + "])");
			})
			var selectedsymbols = [];
			var symbols = document.querySelectorAll(".symbols input[type='checkbox']:checked");
			symbols.forEach(function(elem, key){
				selectedsymbols.push(elem.value);
			})
			if(selectedsymbols.length) requiredptn.push("(?=.*[" + selectedsymbols.join("") + "])");
			// var requiredptn = (selectedsymbols.length) ? "(?=.*[" + selectedsymbols.join("") + "])" : "";
			// var optptn = "^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])" + requiredptn + "[0-9a-zA-Z][0-9a-zA-Z" + selectedsymbols.join("") + "]+[0-9a-zA-Z]$";
			// var optstr = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890" + selectedsymbols.join("");
			var optptn = "^" + requiredptn.join("") + "[" + selectedptntypes.join("") + "][" + selectedptntypes.join("") + selectedsymbols.join("") + "]+[" + selectedptntypes.join("") + "]$";
			var optstr = selectedstrtypes.join("") + selectedsymbols.join("");
			var optnum = document.querySelector("#gen_num").value || 1;
			var optlen = document.querySelector("#gen_len").value || 24;
			var optmax = document.querySelector("#gen_max").value || 999;

			// call construct and overwrite options
			var rs=new RandomStrings({
				// ptn:"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[\-\_])(?=.*[\+])[0-9a-zA-Z][0-9a-zA-Z\-\_\+]+[0-9a-zA-Z]$",
				// str:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_",
				ptn:optptn,
				str:optstr,
				num:optnum,
				len:optlen,
				show:false
			});
			// execute
			var res = rs.exec("#runlog");
			var $result = document.querySelector("#result");
			$result.innerHTML = "";
			res.forEach(function(val, i){
				var $rs = document.createElement("p");
				$rs.innerHTML = val;
				$rs.classList.add("gen_result");
				$rs.setAttribute("readonly", "readonly");
				$result.appendChild($rs);
				$rs.onclick = function(){
					var results = document.querySelectorAll(".gen_result");
					results.forEach(function(elem, key){
						elem.classList.remove("copied");
					})
					toclipboard(val);
					$rs.classList.add("copied");
				};
			});
		}
		var toclipboard = function(text){
			let choise;
			let res;

			if(navigator.userAgent.match(/ipad|iphone/i)){
				choise = "navigator.userAgent.match(/ipad|iphone/i)";
				let range = document.createRange();
				range.selectNodeContents(ta);
				let sel = window.getSelection();
				sel.removeAllRanges();
				sel.addRange(range);
				res = document.execCommand("copy");
			}
			else if(window.clipboardData){
				choise = "window.clipboardData";
				res = window.clipboardData.setData("Text" , text);
			}
			else if(navigator.clipboard){
				choise = "navigator.clipboard";
				res = navigator.clipboard.writeText(text);
			}
			else {
				choise = "ta.select()";
				let ta = document.createElement("textarea");
				ta.value = text;
				ta.setAttribute("readonly", "readonly");
				ta.setAttribute("contenteditable", true);
				ta.style.top = "0";
				ta.style.left = "0";
				ta.style.position = "fixed";
				try {
					document.body.appendChild(ta);
					ta.focus();
					ta.select();
					res = document.execCommand("copy");
				} finally {
					document.body.removeChild(ta);
	//				ta.parentElement.removeChild(ta);
				}
			}
			if(!!!res){
				window.prompt("Copy to clipboard: Ctrl+C, Enter", text);
			}
	//		console.log("toclipboard:%s, text:%s, case:%s", res, text, choise);
			return res;
		}
	</script>
</head>
<body onload="onloaded()">
	<div class="container">
		<h1>ランダム文字列生成</h1>
		<p>※ページ描画時に再生成するため生成文字のコピペ保管忘れずに</p>
		<a href="https://github.com/tokiori/RandomStrings">(github repository)</a>
		<form id="gen_rand_str">
			<h2>生成条件</h2>
			<table>
				<tr>
					<td>長さ</td>
					<td><input type="number" id="gen_len" value="24"></td>
				</tr>
				<tr>
					<td>生成個数</td>
					<td><input type="number" id="gen_num" value="1"></td>
				</tr>
				<tr>
					<td>使用文字</td>
					<td>
						<div class="strtypes">
							<input type="checkbox" value="A-Z" id="strtype_upper" name="strtype_upper" checked>
							<label for="strtype_upper">半角英大文字</label>
						</div>
						<div class="strtypes">
							<input type="checkbox" value="a-z" id="strtype_lower" name="strtype_lower" checked>
							<label for="strtype_lower">半角英小文字</label>
						</div>
						<div class="strtypes">
							<input type="checkbox" value="0-9" id="strtype_number" name="strtype_number" checked disabled>
							<label for="strtype_number">半角数字</label>
						</div>
						<div class="">
							<input type="checkbox" value="" id="strtype_symbol" name="strtype_symbol" disabled>
							<label for="strtype_symbol">記号（下記いずれかを含む）</label>
						</div>
						<div class="symbols">
							<input type="checkbox" value="\+" id="symbol_plus" name="symbol_plus">
							<label for="symbol_plus">+</label>
						</div>
						<div class="symbols">
							<input type="checkbox" value="\-" id="symbol_hyphen" name="symbol_hyphen" checked>
							<label for="symbol_hyphen">-</label>
						</div>
						<div class="symbols">
							<input type="checkbox" value="\_" id="symbol_underscore" name="symbol_underscore" checked>
							<label for="symbol_underscore">_</label>
						</div>
						<div class="symbols">
							<input type="checkbox" value="\?" id="symbol_question" name="symbol_question">
							<label for="symbol_question">?</label>
						</div>
						<div class="symbols">
							<input type="checkbox" value="\!" id="symbol_exclamation" name="symbol_exclamation">
							<label for="symbol_exclamation">!</label>
						</div>
					</td>
				</tr>
				<tr>
					<td>試行回数</td>
					<td><input type="number" id="gen_max" value="999"></td>
				</tr>
			</table>
			<br>
			<input type="button" value="生成実行" onclick="run()" style="font-weight: bold;">
		</form>
		<div>
			<h2>生成結果</h2>
			<p>タップでクリップボードへコピー</p>
			<p id="result"></p>
		</div>
		<div>
			<h2>実行ログ</h2>
			<p id="runlog"></p>
		</div>
	</div>
</body>
</html>
